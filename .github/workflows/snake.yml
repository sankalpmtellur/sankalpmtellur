name: üêç GitHub Snake Game

on:
  # Schedule the workflow to run every 6 hours for more frequent updates
  schedule:
    - cron: "0 */6 * * *"
  # Allow manual triggering of the workflow
  workflow_dispatch:
  # Trigger the workflow on pushes to the main branch
  push:
    branches:
      - main
  # Run when the workflow is requested
  workflow_call:

jobs:
  generate-snake:
    name: Generate Snake Animation
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      # Step 1: Checkout the repository
      - name: üõ†Ô∏è Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      # Step 2: Generate the snake animations with multiple themes
      - name: üé® Generate Snake Animations
        uses: Platane/snk@v3
        id: snake-gif
        with:
          github_user_name: ${{ github.repository_owner }}
          outputs: |
            dist/github-snake.svg
            dist/github-snake-dark.svg?palette=github-dark
            
            # Neon Theme
            dist/neon-snake.svg?color_snake=#00ff9d&color_dots=#ff00ff,#00ffff,#ffff00,#ff00ff,#00ffff
            
            # Sunset Theme
            dist/sunset-snake.svg?color_snake=#ff6b6b&color_dots=#ff9e7d,#ffd166,#06d6a0,#118ab2,#073b4c
            
            # Ocean Theme
            dist/ocean-snake.svg?color_snake=#4cc9f0&color_dots=#4361ee,#3a0ca3,#7209b7,#f72585,#4cc9f0
            
            # Matrix Theme
            dist/matrix-snake.svg?color_snake=#00ff41&color_dots=#008f11,#00ff41,#0fa,#0f0
            
            # Animated GIFs
            dist/neon-snake.gif?color_snake=#00ff9d&color_dots=#ff00ff,#00ffff,#ffff00&speed=0.5
            dist/matrix-snake.gif?color_snake=#00ff41&color_dots=#008f11,#00ff41,#0fa,#0f0&speed=1.5
            
            # Special configurations
            dist/compact-snake.svg?color_snake=#f72585&color_dots=#4cc9f0,#4361ee,#3a0ca3&size=2&gap=1
            
            # Dark mode with custom colors
            dist/dark-snake.svg?color_bg=1a1b27&color_snake=#7f5af0&color_dots=#2cb67d,#7f5af0,#2cb67d&size=3
            
            # Rainbow snake
            dist/rainbow-snake.svg?color_snake=#ff0000,#ff7f00,#ffff00,#00ff00,#0000ff,#4b0082,#8b00ff&color_dots=#000000&size=4
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      # Step 3: Deploy the generated files to the 'output' branch
      - name: üöÄ Deploy Snake Animations
        if: success()
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: dist
          branch: output
          clean: true
          clean-exclude: |
            README.md
            CNAME
          commit-message: "üå± Update snake animations [skip ci]"
          force: true
          single-commit: true
          silent: true

      # Step 4: Update README with the new snake animation
      - name: üìù Update README
        if: success()
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "üìå Update README with new snake animation [skip ci]"
          file_pattern: README.md
          commit_user_name: "GitHub Actions"
          commit_user_email: "actions@github.com"
          commit_author: "GitHub Actions <noreply@github.com>"

      # Step 5: Create a PR comment with the new snake animation
      - name: üí¨ Create PR Comment
        if: github.event_name == 'pull_request' && success()
        uses: marocchino/sticky-pull-request-comment@v2
        with:
          message: |
            ### üêç Snake Animation Updated!
            
            Check out the latest snake animation with your contributions!
            
            ![Neon Snake](https://raw.githubusercontent.com/${{ github.repository }}/output/neon-snake.gif)
            
            _Generated at: ${{ steps.snake-gif.outputs.snake-created-at }}_{{ github.run_number }}_
